!function(){angular.module("w-google-picker",[]).provider("wGoogleSettings",function(){this.developerKey=null,this.clientId=null,this.appId=null,this.scope=["https://www.googleapis.com/auth/drive"],this.locale="it",this.features=["MULTISELECT_ENABLED","SUPPORT_TEAM_DRIVES"],this.views=["DocsView().setIncludeFolders(true).setSelectFolderEnabled(true).setEnableTeamDrives(true)"],this.$get=["$window",function(e){return{developerKey:this.developerKey,clientId:this.clientId,appId:this.appId,scope:this.scope,features:this.features,views:this.views,locale:this.locale,origin:this.origin||e.location.protocol+"//"+e.location.host}}],this.configure=function(e){for(var o in e)this[o]=e[o]}}).directive("wGooglePicker",["$window","wGoogleSettings",function($window,wGoogleSettings){return{restrict:"A",scope:{onLoaded:"&",onCancel:"&",onPicked:"&"},link:function(scope,element,attrs){function instantiate(){gapi.load("auth",{callback:onAuthApiLoad}),gapi.load("picker",{callback:onPickerApiLoad})}function onAuthApiLoad(){oauthToken?createPicker():gapi.auth.authorize({client_id:wGoogleSettings.clientId,scope:wGoogleSettings.scope,immediate:!1},handleAuthResult)}function onPickerApiLoad(){pickerApiLoaded=!0,createPicker()}function handleAuthResult(e){e&&!e.error&&(oauthToken=e.access_token,createPicker())}function createPicker(){if(pickerApiLoaded&&oauthToken){var picker=(new $window.google.picker.PickerBuilder).setAppId(wGoogleSettings.appId).setOAuthToken(oauthToken).setDeveloperKey(wGoogleSettings.developerKey).setLocale(wGoogleSettings.locale).setCallback(pickerCallback).setOrigin(wGoogleSettings.origin);wGoogleSettings.features.length>0&&wGoogleSettings.features.forEach(function(e,o){picker.enableFeature(google.picker.Feature[e])}),wGoogleSettings.views.length>0&&wGoogleSettings.views.forEach(function(view,key){view=eval("new google.picker."+view),picker.addView(view)}),picker.build().setVisible(!0)}}function pickerCallback(e){gapi.client.load("drive","v3",function(){e.action==google.picker.Action.LOADED&&scope.onLoaded&&(scope.onLoaded||angular.noop)(),e.action==google.picker.Action.CANCEL&&scope.onCancel&&(scope.onCancel||angular.noop)(),e.action==google.picker.Action.PICKED&&scope.onPicked&&(scope.onPicked||angular.noop)({docs:e.docs}),scope.$apply()})}var pickerApiLoaded=!1,oauthToken=null;element.bind("click",function(e){instantiate()})}}}])}();